# Bil-to-Boogie Translator

## Development 

## Setup 

 1. Download and install [sbt](https://www.scala-sbt.org/download.html) and [boogie](https://www.scala-sbt.org/download.html). If you use an operating system with a package manager then the easiest way to install these is likey through your pacage manager (e.g. aur)
 2. Clone the repo

This should be everything. For more details on SBT and getting SBT to work correctly with Intellij see the section below.

### Running a file

To run a single file use the command 

`sbt run file.bil file.elf boogie`

where `file.bil` is the lifted BIL file and `file.elf` is the elf file (for an example of how to generate this, look at `src/scripts/lift\_docker.sh`). A range of sample files can be found in the `samples` folder.

If you are likely to want to run multiple files you can launch the SBT shell using `sbt` and then run each file inside this shell using

`run file.bil file.elf boogie`

This saves the time having to wait for SBT to start.


### Running test suit

To run the test suite run

`sbt test`

This runs a collection of the samples, checking that the correct number of errors are produced and that these occur on the corect line numbers. 

### Manually executing boogie files

It can be helpful to manually run boogie files. For example, to make manual edits to the generated boogie file (`boogie_out.bpl`) for debugging purposes or to run one of the sample output files. To do this run

`boogie boogie.bpl`

where `boogie.bpl` is the name of the boogie file.


### Notes about SBT

The project uses the scala build tool (SBT) to build the project. For the most part this should *just work*, and there are intellij run files (located in the .run folder) which automatically compile and run the project.
However, there are some issues when it comes to using the project in intellij. In particular, it is necassary to go into `target/scala-3.0.0/src_managed` and unmark `main` as a sources root folder. It may also be necassary
to go into a java file and manually enabling `Highlight: All Problems` using the tick in the top right.
Alternatively, these issues do not appear when using the metals LSP (for example when using neovim or vscode).

## Tool Overview

The tool consists of 3 distinct parts: the translation, static analysis and vc generation. 

The translator takes a `State`, generated by the parser, and transforms it to fit the intermediate representation. It has a range of steps, including ...

The static analysis performs a range of different analysies. The aim of these analysies is generally to speed up the Boogie processing time by reducing the complexity of the predicates. Static analysis steps can be 

The VC generation is performed after the previous two steps and generates the final verification conditions (this includes relies). 
Additional verification conditions could be added. For example, ...(TODO: double free)...

### Flow Graph vs State

### Calling Convention

The tool tries to match the ARM calling convention, which specifies that R0-R7 are the parameter/return registers and may be modified by the calling function. As such all of these parameters are passed into and returned from each function.

The tool cannot yet handle the case where parameters are stored on the stack (e.g. if more than 8 parameters is passed). 



## Thingss left to do

 - Guarantees
 - Loops
 - General lattice

### Tasks for the Summer

 - Replace nulls with option where possible
 - Better handling toStrings (there is a lot of overlap between pred/exp and between toString/toBoogieString)
 - At the moment all of the call registers (i.e. R0-R7) are passed as parameters, maybe it would be better to make these globals? in general this code could be neatedned up


 - calling (in particular when not all parameters can be put into registers)
 - boogie translator not as useful

